<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Server Setup Guide - ClubCalendar</title>
    <style>
        :root {
            --primary: #2c5aa0;
            --primary-dark: #1e4080;
            --text: #333;
            --text-light: #666;
            --bg: #fff;
            --bg-alt: #f8f9fa;
            --border: #e0e0e0;
            --code-bg: #f4f4f4;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.7;
            color: var(--text);
            margin: 0;
            padding: 0;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Header */
        .header {
            background: var(--primary);
            color: white;
            padding: 20px;
        }

        .header-inner {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header a {
            color: white;
        }

        .header h1 {
            font-size: 1.3rem;
            margin: 0;
        }

        .header nav a {
            margin-left: 20px;
            opacity: 0.9;
        }

        .header nav a:hover {
            opacity: 1;
            text-decoration: none;
        }

        /* Main content */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            line-height: 1.3;
        }

        h1 { font-size: 2rem; margin-top: 0; }
        h2 { font-size: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: 0.3em; }
        h3 { font-size: 1.25rem; }
        h4 { font-size: 1.1rem; }

        p {
            margin: 1em 0;
        }

        ul, ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        li {
            margin: 0.5em 0;
        }

        /* Code */
        code {
            background: var(--code-bg);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1.5em 0;
        }

        pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
        }

        th, td {
            border: 1px solid var(--border);
            padding: 10px 12px;
            text-align: left;
        }

        th {
            background: var(--bg-alt);
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: var(--bg-alt);
        }

        /* Blockquote */
        blockquote {
            border-left: 4px solid var(--primary);
            margin: 1.5em 0;
            padding: 10px 20px;
            background: var(--bg-alt);
        }

        blockquote p {
            margin: 0;
        }

        /* Horizontal rule */
        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2em 0;
        }

        /* Back link */
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: var(--text-light);
        }

        .back-link:hover {
            color: var(--primary);
        }

        /* Footer */
        .footer {
            border-top: 1px solid var(--border);
            padding: 30px 20px;
            text-align: center;
            color: var(--text-light);
            margin-top: 60px;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header-inner {
                flex-direction: column;
                gap: 10px;
            }

            pre {
                padding: 15px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="header-inner">
        <h1><a href="../index.html">ClubCalendar</a></h1>
        <nav>
            <a href="../index.html">Home</a>
            <a href="https://github.com/edforman-75/clubcalendar">GitHub</a>
        </nav>
    </div>
</header>

<main class="container">
    <a href="../index.html" class="back-link">← Back to Home</a>

    <h1 id="clubcalendar-custom-server-setup-guide">ClubCalendar Custom
Server Setup Guide</h1>
<p>This guide walks you through setting up ClubCalendar on your own
server (like mail.sbnewcomers.org).</p>
<hr />
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Linux server with:
<ul>
<li>Python 3.8+</li>
<li>Cron</li>
<li>Web server (Apache/Nginx) for serving static files</li>
</ul></li>
<li>Wild Apricot admin access (for API credentials)</li>
</ul>
<hr />
<h2 id="overview">Overview</h2>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                     Your Server                             │
│                                                             │
│  /etc/clubcalendar/                                         │
│  └── config.json          ← Organization configuration      │
│                                                             │
│  /opt/clubcalendar/                                         │
│  └── sync/                ← Sync scripts                    │
│      ├── sync.py                                            │
│      ├── config.py                                          │
│      └── storage.py                                         │
│                                                             │
│  /var/www/clubcalendar/                                     │
│  ├── data/                                                  │
│  │   └── {org_id}/                                          │
│  │       └── events.json  ← Generated every 15 min          │
│  ├── widget/                                                │
│  │   └── clubcalendar-widget.js                             │
│  └── admin/                                                 │
│      └── index.html       ← Configuration UI                │
│                                                             │
│  Cron: */15 * * * * python3 /opt/clubcalendar/sync/sync.py  │
│                                                             │
└─────────────────────────────────────────────────────────────┘</code></pre>
<hr />
<h2 id="step-1-get-wild-apricot-api-credentials">Step 1: Get Wild
Apricot API Credentials</h2>
<ol type="1">
<li><p>Log into Wild Apricot admin</p></li>
<li><p>Go to <strong>Settings</strong> → <strong>Authorized
applications</strong></p></li>
<li><p>Click <strong>Authorize application</strong></p></li>
<li><p>Fill in:</p>
<ul>
<li><strong>Application name:</strong> ClubCalendar Sync</li>
<li><strong>Permissions:</strong> Check all read permissions for Events,
Contacts</li>
</ul></li>
<li><p>Click <strong>Authorize</strong></p></li>
<li><p>Copy and save:</p>
<ul>
<li><strong>API key</strong></li>
<li><strong>Account ID</strong> (from Settings → General)</li>
</ul></li>
</ol>
<hr />
<h2 id="step-2-create-directory-structure">Step 2: Create Directory
Structure</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create directories</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /opt/clubcalendar/sync</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /etc/clubcalendar</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /var/www/clubcalendar/<span class="dt">{data</span><span class="op">,</span><span class="dt">widget</span><span class="op">,</span><span class="dt">admin}</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Set permissions (adjust user as needed)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> www-data:www-data /var/www/clubcalendar</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> <span class="va">$USER</span>:<span class="va">$USER</span> /opt/clubcalendar</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> <span class="va">$USER</span>:<span class="va">$USER</span> /etc/clubcalendar</span></code></pre></div>
<hr />
<h2 id="step-3-install-sync-scripts">Step 3: Install Sync Scripts</h2>
<p>Copy the sync scripts to the server:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From your development machine</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> sync.py config.py storage.py user@yourserver:/opt/clubcalendar/sync/</span></code></pre></div>
<p>Or clone/copy the files:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /opt/clubcalendar/sync</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the files (copy content from the repository)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># - sync.py</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># - config.py</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - storage.py</span></span></code></pre></div>
<p>Install dependencies:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip3</span> install requests</span></code></pre></div>
<hr />
<h2 id="step-4-create-configuration-file">Step 4: Create Configuration
File</h2>
<p>Create <code>/etc/clubcalendar/config.json</code>:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;org_id&quot;</span><span class="fu">:</span> <span class="st">&quot;sbnc&quot;</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;deployment&quot;</span><span class="fu">:</span> <span class="st">&quot;custom_server&quot;</span><span class="fu">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;wild_apricot&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;account_id&quot;</span><span class="fu">:</span> <span class="st">&quot;YOUR_ACCOUNT_ID&quot;</span><span class="fu">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;api_key&quot;</span><span class="fu">:</span> <span class="st">&quot;YOUR_API_KEY&quot;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;data_directory&quot;</span><span class="fu">:</span> <span class="st">&quot;/var/www/clubcalendar/data&quot;</span><span class="fu">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;base_url&quot;</span><span class="fu">:</span> <span class="st">&quot;https://mail.sbnewcomers.org/clubcalendar&quot;</span><span class="fu">,</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;sync&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;interval_minutes&quot;</span><span class="fu">:</span> <span class="dv">15</span><span class="fu">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;include_past_days&quot;</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;auto_tag_rules&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;name-prefix&quot;</span><span class="fu">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;Happy Hikers:&quot;</span><span class="fu">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;tag&quot;</span><span class="fu">:</span> <span class="st">&quot;committee:happy-hikers&quot;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;name-prefix&quot;</span><span class="fu">,</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;Games!:&quot;</span><span class="fu">,</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;tag&quot;</span><span class="fu">:</span> <span class="st">&quot;committee:games&quot;</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;name-prefix&quot;</span><span class="fu">,</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;Wine Appreciation:&quot;</span><span class="fu">,</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;tag&quot;</span><span class="fu">:</span> <span class="st">&quot;committee:wine-appreciation&quot;</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;name-contains&quot;</span><span class="fu">,</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;wine&quot;</span><span class="fu">,</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;tag&quot;</span><span class="fu">:</span> <span class="st">&quot;activity:wine&quot;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;name-contains&quot;</span><span class="fu">,</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;hike&quot;</span><span class="fu">,</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;tag&quot;</span><span class="fu">:</span> <span class="st">&quot;activity:outdoors&quot;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;name-contains&quot;</span><span class="fu">,</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;pattern&quot;</span><span class="fu">:</span> <span class="st">&quot;dinner&quot;</span><span class="fu">,</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;tag&quot;</span><span class="fu">:</span> <span class="st">&quot;activity:food&quot;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;derived_fields&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;time_of_day&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;morning&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;before&quot;</span><span class="fu">:</span> <span class="dv">12</span><span class="fu">},</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;afternoon&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;from&quot;</span><span class="fu">:</span> <span class="dv">12</span><span class="fu">,</span> <span class="dt">&quot;before&quot;</span><span class="fu">:</span> <span class="dv">17</span><span class="fu">},</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;evening&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;from&quot;</span><span class="fu">:</span> <span class="dv">17</span><span class="fu">}</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Secure the config file:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 600 /etc/clubcalendar/config.json</span></code></pre></div>
<hr />
<h2 id="step-5-test-the-sync-script">Step 5: Test the Sync Script</h2>
<p>Run manually to verify:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /opt/clubcalendar/sync</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CLUBCAL_CONFIG_FILE</span><span class="op">=</span>/etc/clubcalendar/config.json</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">CLUBCAL_DEPLOYMENT</span><span class="op">=</span>custom_server</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">python3</span> sync.py</span></code></pre></div>
<p>Expected output:</p>
<pre><code>2025-12-09 10:30:00 [INFO] Loaded config for org: sbnc
2025-12-09 10:30:00 [INFO] Refreshing WA API token
2025-12-09 10:30:01 [INFO] Fetching events from WA API (since 2025-12-09)
2025-12-09 10:30:02 [INFO] Fetched 47 events from WA
2025-12-09 10:30:02 [INFO] Transformed 47 events
2025-12-09 10:30:02 [INFO] Saved events to /var/www/clubcalendar/data/sbnc/events.json
Success: Synced 47 events
Output: https://mail.sbnewcomers.org/clubcalendar/data/sbnc/events.json</code></pre>
<p>Verify the JSON file was created:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-la</span> /var/www/clubcalendar/data/sbnc/</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /var/www/clubcalendar/data/sbnc/events.json <span class="kw">|</span> <span class="fu">head</span> <span class="at">-20</span></span></code></pre></div>
<hr />
<h2 id="step-6-set-up-cron-job">Step 6: Set Up Cron Job</h2>
<p>Edit crontab:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">crontab</span> <span class="at">-e</span></span></code></pre></div>
<p>Add this line:</p>
<pre class="cron"><code># ClubCalendar sync - every 15 minutes
*/15 * * * * CLUBCAL_CONFIG_FILE=/etc/clubcalendar/config.json CLUBCAL_DEPLOYMENT=custom_server /usr/bin/python3 /opt/clubcalendar/sync/sync.py &gt;&gt; /var/log/clubcalendar-sync.log 2&gt;&amp;1</code></pre>
<p>Create log file:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> touch /var/log/clubcalendar-sync.log</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="va">$USER</span>:<span class="va">$USER</span> /var/log/clubcalendar-sync.log</span></code></pre></div>
<hr />
<h2 id="step-7-configure-web-server">Step 7: Configure Web Server</h2>
<h3 id="apache">Apache</h3>
<p>Add to your Apache config or create
<code>/etc/apache2/sites-available/clubcalendar.conf</code>:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode apache"><code class="sourceCode apache"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Alias<span class="st"> /clubcalendar /var/www/clubcalendar</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;Directory</span><span class="at"> /var/www/clubcalendar</span><span class="fu">&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Options</span><span class="ch"> </span><span class="kw">Indexes</span><span class="ch"> </span><span class="kw">FollowSymLinks</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">AllowOverride</span><span class="ch"> </span><span class="kw">None</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Require<span class="st"> all granted</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CORS headers for widget</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    Header<span class="st"> set Access-Control-Allow-Origin &quot;*&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    Header<span class="st"> set Access-Control-Allow-Methods &quot;GET&quot;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    Header<span class="st"> set Access-Control-Allow-Headers &quot;Content-Type&quot;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cache control for events.json (short cache since it updates often)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&lt;FilesMatch</span><span class="at"> &quot;events\.json$&quot;</span><span class="fu">&gt;</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        Header<span class="st"> set Cache-Control &quot;max-age=300, public&quot;</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&lt;/FilesMatch&gt;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cache control for widget JS (longer cache)</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&lt;FilesMatch</span><span class="at"> &quot;\.js$&quot;</span><span class="fu">&gt;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        Header<span class="st"> set Cache-Control &quot;max-age=86400, public&quot;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">&lt;/FilesMatch&gt;</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;/Directory&gt;</span></span></code></pre></div>
<p>Enable and restart:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> a2enmod headers</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> a2ensite clubcalendar</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart apache2</span></code></pre></div>
<h3 id="nginx">Nginx</h3>
<p>Add to your Nginx config:</p>
<pre class="nginx"><code>location /clubcalendar {
    alias /var/www/clubcalendar;

    # CORS
    add_header Access-Control-Allow-Origin &quot;*&quot;;
    add_header Access-Control-Allow-Methods &quot;GET&quot;;

    # Cache control
    location ~* events\.json$ {
        add_header Cache-Control &quot;max-age=300, public&quot;;
    }

    location ~* \.js$ {
        add_header Cache-Control &quot;max-age=86400, public&quot;;
    }
}</code></pre>
<p>Restart:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart nginx</span></code></pre></div>
<hr />
<h2 id="step-8-install-widget-and-admin-ui">Step 8: Install Widget and
Admin UI</h2>
<p>Copy widget JavaScript:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /path/to/clubcalendar/widget/clubcalendar-widget.js /var/www/clubcalendar/widget/</span></code></pre></div>
<p>Copy admin UI:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /path/to/clubcalendar/admin/index.html /var/www/clubcalendar/admin/</span></code></pre></div>
<hr />
<h2 id="step-9-verify-everything-works">Step 9: Verify Everything
Works</h2>
<ol type="1">
<li><p><strong>Check events.json is accessible:</strong></p>
<pre><code>curl https://mail.sbnewcomers.org/clubcalendar/data/sbnc/events.json</code></pre></li>
<li><p><strong>Check widget.js is accessible:</strong></p>
<pre><code>curl https://mail.sbnewcomers.org/clubcalendar/widget/clubcalendar-widget.js | head</code></pre></li>
<li><p><strong>Check admin UI:</strong> Open in browser:
<code>https://mail.sbnewcomers.org/clubcalendar/admin/</code></p></li>
</ol>
<hr />
<h2 id="step-10-whitelist-your-server-in-wild-apricot">Step 10:
Whitelist Your Server in Wild Apricot</h2>
<p>Before embedding external JavaScript, you must add your server to
Wild Apricot’s authorized domains list.</p>
<ol type="1">
<li><p>Log into Wild Apricot admin</p></li>
<li><p>Go to <strong>Settings</strong> → <strong>Site</strong> →
<strong>Global settings</strong></p></li>
<li><p>Scroll to <strong>External JavaScript
authorization</strong></p></li>
<li><p>Click <strong>Add URL</strong></p></li>
<li><p>Enter your server domain:
<code>https://mail.sbnewcomers.org</code></p></li>
<li><p>Click <strong>Save</strong></p></li>
</ol>
<p>Without this step, Wild Apricot will block the widget JavaScript from
loading.</p>
<hr />
<h2 id="step-11-embed-in-wild-apricot">Step 11: Embed in Wild
Apricot</h2>
<ol type="1">
<li><p>In WA, edit the page where you want the calendar</p></li>
<li><p>Add a <strong>Code</strong> or <strong>HTML</strong>
gadget</p></li>
<li><p>Paste:</p></li>
</ol>
<div class="sourceCode" id="cb22"><pre
class="sourceCode html"><code class="sourceCode html"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ClubCalendar Widget --&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">&quot;clubcalendar&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">CLUBCALENDAR_CONFIG</span> <span class="op">=</span> {</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">eventsUrl</span><span class="op">:</span> <span class="st">&#39;https://mail.sbnewcomers.org/clubcalendar/data/sbnc/events.json&#39;</span><span class="op">,</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Find Events&#39;</span><span class="op">,</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">primaryColor</span><span class="op">:</span> <span class="st">&#39;#2c5aa0&#39;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">script</span><span class="ot"> src</span><span class="op">=</span><span class="st">&quot;https://mail.sbnewcomers.org/clubcalendar/widget/clubcalendar-widget.js&quot;</span><span class="dt">&gt;&lt;/</span><span class="kw">script</span><span class="dt">&gt;</span></span></code></pre></div>
<ol start="4" type="1">
<li>Save and preview</li>
</ol>
<hr />
<h2 id="maintenance">Maintenance</h2>
<h3 id="viewing-logs">Viewing Logs</h3>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recent sync activity</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-50</span> /var/log/clubcalendar-sync.log</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Watch live</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span> <span class="at">-f</span> /var/log/clubcalendar-sync.log</span></code></pre></div>
<h3 id="manually-triggering-sync">Manually Triggering Sync</h3>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /opt/clubcalendar/sync</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="va">CLUBCAL_CONFIG_FILE</span><span class="op">=</span>/etc/clubcalendar/config.json <span class="va">CLUBCAL_DEPLOYMENT</span><span class="op">=</span>custom_server <span class="ex">python3</span> sync.py</span></code></pre></div>
<h3 id="updating-configuration">Updating Configuration</h3>
<ol type="1">
<li>Edit <code>/etc/clubcalendar/config.json</code></li>
<li>Changes take effect on next sync (within 15 minutes)</li>
</ol>
<h3 id="updating-widget">Updating Widget</h3>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /path/to/new/clubcalendar-widget.js /var/www/clubcalendar/widget/</span></code></pre></div>
<h3 id="log-rotation">Log Rotation</h3>
<p>Create <code>/etc/logrotate.d/clubcalendar</code>:</p>
<pre><code>/var/log/clubcalendar-sync.log {
    weekly
    rotate 4
    compress
    missingok
    notifempty
}</code></pre>
<hr />
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="sync-not-running">Sync not running</h3>
<div class="sourceCode" id="cb27"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cron is running</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">systemctl</span> status cron</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check cron logs</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> clubcalendar /var/log/syslog</span></code></pre></div>
<h3 id="api-authentication-failing">API authentication failing</h3>
<ul>
<li>Verify API key in config.json</li>
<li>Check WA authorized application is still active</li>
<li>Try regenerating API key in WA</li>
</ul>
<h3 id="events.json-not-updating">Events.json not updating</h3>
<ul>
<li>Check log file for errors</li>
<li>Verify write permissions on data directory</li>
<li>Run sync manually to see errors</li>
</ul>
<h3 id="widget-not-loading">Widget not loading</h3>
<ul>
<li>Check browser console for errors</li>
<li>Verify CORS headers are set</li>
<li>Check events.json URL is accessible</li>
</ul>
<hr />
<h2 id="file-reference">File Reference</h2>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/etc/clubcalendar/config.json</code></td>
<td>Main configuration</td>
</tr>
<tr>
<td><code>/opt/clubcalendar/sync/sync.py</code></td>
<td>Main sync script</td>
</tr>
<tr>
<td><code>/opt/clubcalendar/sync/config.py</code></td>
<td>Configuration loader</td>
</tr>
<tr>
<td><code>/opt/clubcalendar/sync/storage.py</code></td>
<td>Storage abstraction</td>
</tr>
<tr>
<td><code>/var/www/clubcalendar/data/{org}/events.json</code></td>
<td>Generated events file</td>
</tr>
<tr>
<td><code>/var/www/clubcalendar/widget/clubcalendar-widget.js</code></td>
<td>Widget JavaScript</td>
</tr>
<tr>
<td><code>/var/www/clubcalendar/admin/index.html</code></td>
<td>Admin configuration UI</td>
</tr>
<tr>
<td><code>/var/log/clubcalendar-sync.log</code></td>
<td>Sync log file</td>
</tr>
</tbody>
</table>
<hr />
<p><em>This guide is for ClubCalendar v1.0</em></p>
</main>

<footer class="footer">
    <p>ClubCalendar — Open source calendar widget for Wild Apricot</p>
</footer>

</body>
</html>
