<!--
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ClubCalendar Inline Render Engine v1.0.0
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  INPUTS:
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Container element: <div id="clubcalendar-root"></div>

  2. Configuration object (set BEFORE this script loads):
     window.CLUBCALENDAR_CONFIG = {
       // REQUIRED
       events: [],                    // Array of event objects (see Event Schema)

       // OPTIONAL - Display
       headerTitle: 'Events',         // Header text
       showHeader: true,              // Show/hide header
       showFilters: true,             // Show/hide filter controls
       emptyMessage: 'No events',     // Message when no events match filters

       // OPTIONAL - Theming
       primaryColor: '#2c5aa0',       // Primary brand color
       accentColor: '#d4a800',        // Accent/highlight color

       // OPTIONAL - Behavior
       maxEvents: 50,                 // Max events to display (0 = unlimited)
       isPublicMode: false,           // If true, filters out member-only events
       autoTagRules: []               // Auto-tagging rules (see below)
     };

  3. Event Schema:
     {
       id: number | string,           // Unique identifier
       name: string,                  // Event title
       startDate: string,             // ISO 8601 date (required)
       endDate: string,               // ISO 8601 date (optional)
       location: string,              // Location text
       description: string,           // HTML-safe description (will be escaped)
       url: string,                   // Link to event details
       tags: string[],                // Manual tags
       accessLevel: string,           // 'Public' | 'Members Only' | etc.
       isFree: boolean,               // True if free event
       spotsAvailable: number | null  // Null = unlimited
     }

  4. Auto-Tag Rules:
     { type: 'name-prefix', pattern: 'Happy Hikers:', tag: 'committee:happy-hikers' }
     Types: 'name-prefix' | 'name-contains' | 'name-suffix'

  GUARANTEES:
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  - NO external script loading (fully self-contained)
  - NO external stylesheet loading
  - NO inline event handlers (uses event delegation)
  - NO member-only content exposed in public mode (isPublicMode: true)
  - NO XSS: all user content is escaped before rendering
  - NO server calls: renders from provided data only
  - CSP-compatible: no eval(), no inline handlers

  USAGE:
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. Place <div id="clubcalendar-root"></div> where you want the calendar
  2. Set window.CLUBCALENDAR_CONFIG with your events array
  3. Paste this entire file into a WA Custom HTML gadget (after the config)

  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->

<div id="clubcalendar-root"></div>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ClubCalendar Inline Engine - Scoped Styles
   All classes prefixed with .cc- to prevent conflicts
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

#clubcalendar-root {
  --cc-primary: var(--cc-primary-override, #2c5aa0);
  --cc-accent: var(--cc-accent-override, #d4a800);
  --cc-bg: #ffffff;
  --cc-text: #333333;
  --cc-text-muted: #666666;
  --cc-border: #e0e0e0;
  --cc-hover-bg: #f5f5f5;
  --cc-shadow: 0 2px 4px rgba(0,0,0,0.1);
  --cc-radius: 6px;

  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: var(--cc-text);
  background: var(--cc-bg);
  max-width: 900px;
  margin: 0 auto;
}

/* Header */
.cc-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0;
  border-bottom: 2px solid var(--cc-primary);
  margin-bottom: 16px;
}

.cc-header-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--cc-primary);
  margin: 0;
}

.cc-header-count {
  font-size: 0.875rem;
  color: var(--cc-text-muted);
  background: var(--cc-hover-bg);
  padding: 4px 12px;
  border-radius: 12px;
}

/* Filters */
.cc-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 12px 0;
  border-bottom: 1px solid var(--cc-border);
  margin-bottom: 16px;
}

.cc-filter-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid var(--cc-border);
  border-radius: 16px;
  background: var(--cc-bg);
  color: var(--cc-text);
  font-size: 0.8125rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.cc-filter-btn:hover {
  background: var(--cc-hover-bg);
  border-color: var(--cc-primary);
}

.cc-filter-btn[aria-pressed="true"] {
  background: var(--cc-primary);
  border-color: var(--cc-primary);
  color: #ffffff;
}

.cc-filter-btn[aria-pressed="true"]:hover {
  opacity: 0.9;
}

/* Event List */
.cc-event-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.cc-event-card {
  display: flex;
  gap: 16px;
  padding: 16px;
  border: 1px solid var(--cc-border);
  border-radius: var(--cc-radius);
  background: var(--cc-bg);
  transition: box-shadow 0.15s ease, border-color 0.15s ease;
}

.cc-event-card:hover {
  border-color: var(--cc-primary);
  box-shadow: var(--cc-shadow);
}

.cc-event-card[data-clickable="true"] {
  cursor: pointer;
}

/* Date Column */
.cc-date-col {
  flex-shrink: 0;
  width: 54px;
  text-align: center;
  padding: 8px;
  background: var(--cc-hover-bg);
  border-radius: var(--cc-radius);
}

.cc-date-month {
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--cc-primary);
  letter-spacing: 0.05em;
}

.cc-date-day {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--cc-text);
  line-height: 1.2;
}

.cc-date-weekday {
  font-size: 0.6875rem;
  color: var(--cc-text-muted);
  text-transform: uppercase;
}

/* Event Info */
.cc-event-info {
  flex: 1;
  min-width: 0;
}

.cc-event-name {
  font-size: 1rem;
  font-weight: 600;
  color: var(--cc-text);
  margin: 0 0 4px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.cc-event-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  font-size: 0.8125rem;
  color: var(--cc-text-muted);
  margin-bottom: 8px;
}

.cc-event-meta-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.cc-event-meta-icon {
  width: 14px;
  height: 14px;
  opacity: 0.7;
}

/* Tags */
.cc-event-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.cc-tag {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.6875rem;
  font-weight: 500;
  border-radius: 10px;
  background: var(--cc-hover-bg);
  color: var(--cc-text-muted);
}

.cc-tag--free {
  background: #e8f5e9;
  color: #2e7d32;
}

.cc-tag--limited {
  background: #fff3e0;
  color: #e65100;
}

.cc-tag--full {
  background: #ffebee;
  color: #c62828;
}

.cc-tag--public {
  background: #e3f2fd;
  color: #1565c0;
}

/* Status Badges */
.cc-status-col {
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

.cc-status-badge {
  padding: 4px 10px;
  font-size: 0.6875rem;
  font-weight: 600;
  border-radius: 12px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.cc-status-badge--open {
  background: #e8f5e9;
  color: #2e7d32;
}

.cc-status-badge--limited {
  background: #fff3e0;
  color: #e65100;
}

.cc-status-badge--full {
  background: #ffebee;
  color: #c62828;
}

/* Empty State */
.cc-empty {
  text-align: center;
  padding: 48px 24px;
  color: var(--cc-text-muted);
}

.cc-empty-icon {
  font-size: 3rem;
  margin-bottom: 16px;
  opacity: 0.5;
}

.cc-empty-message {
  font-size: 1rem;
  margin: 0;
}

/* Loading State */
.cc-loading {
  text-align: center;
  padding: 48px 24px;
  color: var(--cc-text-muted);
}

.cc-loading-spinner {
  display: inline-block;
  width: 32px;
  height: 32px;
  border: 3px solid var(--cc-border);
  border-top-color: var(--cc-primary);
  border-radius: 50%;
  animation: cc-spin 0.8s linear infinite;
}

@keyframes cc-spin {
  to { transform: rotate(360deg); }
}

/* Error State */
.cc-error {
  text-align: center;
  padding: 24px;
  background: #ffebee;
  border: 1px solid #ef9a9a;
  border-radius: var(--cc-radius);
  color: #c62828;
}

/* Responsive */
@media (max-width: 600px) {
  .cc-event-card {
    flex-direction: column;
    gap: 12px;
  }

  .cc-date-col {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
  }

  .cc-date-month,
  .cc-date-day,
  .cc-date-weekday {
    font-size: inherit;
  }

  .cc-date-day {
    font-size: 1.25rem;
  }

  .cc-status-col {
    flex-direction: row;
    justify-content: flex-start;
  }

  .cc-filters {
    gap: 6px;
  }

  .cc-filter-btn {
    font-size: 0.75rem;
    padding: 4px 10px;
  }
}
</style>

<script>
/**
 * ClubCalendar Inline Render Engine v1.0.0
 * Self-contained event list renderer for Wild Apricot
 */
(function() {
  'use strict';

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // CONFIGURATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  var DEFAULT_CONFIG = {
    events: [],
    headerTitle: 'Events',
    showHeader: true,
    showFilters: true,
    emptyMessage: 'No upcoming events found.',
    primaryColor: '#2c5aa0',
    accentColor: '#d4a800',
    maxEvents: 50,
    isPublicMode: false,
    autoTagRules: []
  };

  var config = {};
  var state = {
    events: [],
    filteredEvents: [],
    activeFilters: {}
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // UTILITIES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Escape HTML to prevent XSS
   */
  function escapeHtml(str) {
    if (!str) return '';
    var div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  /**
   * Parse ISO date string safely
   */
  function parseDate(dateStr) {
    if (!dateStr) return null;
    try {
      var d = new Date(dateStr);
      return isNaN(d.getTime()) ? null : d;
    } catch (e) {
      return null;
    }
  }

  /**
   * Format date for display
   */
  function formatDate(date) {
    if (!date) return { month: '', day: '', weekday: '', time: '' };

    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                  'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    var timeStr = hours + ':' + (minutes < 10 ? '0' : '') + minutes + ' ' + ampm;

    return {
      month: months[date.getMonth()],
      day: date.getDate(),
      weekday: days[date.getDay()],
      time: timeStr
    };
  }

  /**
   * Check if event is in the past
   */
  function isPastEvent(event) {
    var start = parseDate(event.startDate);
    return start ? start < new Date() : false;
  }

  /**
   * Check if event is weekend
   */
  function isWeekendEvent(event) {
    var start = parseDate(event.startDate);
    if (!start) return false;
    var day = start.getDay();
    return day === 0 || day === 6;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // AUTO-TAGGING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Apply auto-tagging rules to an event
   */
  function applyAutoTags(event, rules) {
    var autoTags = [];
    var eventName = (event.name || '').toLowerCase();

    for (var i = 0; i < rules.length; i++) {
      var rule = rules[i];
      var pattern = (rule.pattern || '').toLowerCase();
      if (!pattern || !rule.tag) continue;

      var matched = false;
      if (rule.type === 'name-prefix') {
        matched = eventName.indexOf(pattern) === 0;
      } else if (rule.type === 'name-contains') {
        matched = eventName.indexOf(pattern) !== -1;
      } else if (rule.type === 'name-suffix') {
        matched = eventName.indexOf(pattern) === eventName.length - pattern.length;
      }

      if (matched) {
        autoTags.push(rule.tag);
      }
    }

    // Derive time-of-day tag
    var start = parseDate(event.startDate);
    if (start) {
      var hour = start.getHours();
      if (hour < 12) autoTags.push('time:morning');
      else if (hour < 17) autoTags.push('time:afternoon');
      else autoTags.push('time:evening');

      // Weekend tag
      if (isWeekendEvent(event)) {
        autoTags.push('day:weekend');
      }
    }

    // Availability tags
    if (event.spotsAvailable !== null && event.spotsAvailable !== undefined) {
      if (event.spotsAvailable <= 0) autoTags.push('availability:full');
      else if (event.spotsAvailable <= 5) autoTags.push('availability:limited');
      else autoTags.push('availability:open');
    }

    // Cost tag
    if (event.isFree) {
      autoTags.push('cost:free');
    }

    // Access level tag
    if (event.accessLevel === 'Public') {
      autoTags.push('access:public');
    }

    return autoTags;
  }

  /**
   * Transform raw event into display-ready format
   */
  function transformEvent(rawEvent) {
    var manualTags = Array.isArray(rawEvent.tags) ? rawEvent.tags.slice() : [];
    var autoTags = applyAutoTags(rawEvent, config.autoTagRules);

    // Combine and deduplicate tags
    var allTags = manualTags.concat(autoTags);
    var uniqueTags = [];
    var seen = {};
    for (var i = 0; i < allTags.length; i++) {
      if (!seen[allTags[i]]) {
        seen[allTags[i]] = true;
        uniqueTags.push(allTags[i]);
      }
    }

    return {
      id: rawEvent.id,
      name: rawEvent.name || 'Untitled Event',
      startDate: rawEvent.startDate,
      endDate: rawEvent.endDate,
      location: rawEvent.location || '',
      description: rawEvent.description || '',
      url: rawEvent.url || '',
      tags: uniqueTags,
      accessLevel: rawEvent.accessLevel || 'Public',
      isFree: Boolean(rawEvent.isFree),
      spotsAvailable: rawEvent.spotsAvailable,
      isPast: isPastEvent(rawEvent)
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SECURITY: PUBLIC MODE FILTERING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Filter events for public mode - removes member-only content
   */
  function filterForPublicMode(events) {
    if (!config.isPublicMode) return events;

    return events.filter(function(event) {
      // Only show events marked as Public
      return event.accessLevel === 'Public';
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FILTERING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  var FILTER_DEFINITIONS = {
    weekend: {
      label: 'Weekend',
      test: function(event) { return isWeekendEvent(event); }
    },
    free: {
      label: 'Free',
      test: function(event) { return event.isFree; }
    },
    openings: {
      label: 'Has Openings',
      test: function(event) {
        return event.spotsAvailable === null || event.spotsAvailable > 0;
      }
    },
    public: {
      label: 'Public',
      test: function(event) { return event.accessLevel === 'Public'; }
    }
  };

  /**
   * Apply active filters to events
   */
  function applyFilters(events) {
    var activeKeys = Object.keys(state.activeFilters).filter(function(key) {
      return state.activeFilters[key];
    });

    if (activeKeys.length === 0) return events;

    return events.filter(function(event) {
      for (var i = 0; i < activeKeys.length; i++) {
        var filterDef = FILTER_DEFINITIONS[activeKeys[i]];
        if (filterDef && !filterDef.test(event)) {
          return false;
        }
      }
      return true;
    });
  }

  /**
   * Toggle a filter
   */
  function toggleFilter(filterKey) {
    state.activeFilters[filterKey] = !state.activeFilters[filterKey];
    updateDisplay();
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDERING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Render the complete widget
   */
  function render() {
    var container = document.getElementById('clubcalendar-root');
    if (!container) {
      console.error('[ClubCalendar] Container #clubcalendar-root not found');
      return;
    }

    // Apply custom colors via CSS variables
    container.style.setProperty('--cc-primary-override', config.primaryColor);
    container.style.setProperty('--cc-accent-override', config.accentColor);

    var html = [];

    // Header
    if (config.showHeader) {
      html.push(renderHeader());
    }

    // Filters
    if (config.showFilters) {
      html.push(renderFilters());
    }

    // Event list container
    html.push('<div class="cc-event-list" id="cc-event-list"></div>');

    container.innerHTML = html.join('');

    // Render events
    updateDisplay();

    // Setup event delegation
    setupEventListeners(container);
  }

  /**
   * Render header section
   */
  function renderHeader() {
    return '<div class="cc-header">' +
      '<h2 class="cc-header-title">' + escapeHtml(config.headerTitle) + '</h2>' +
      '<span class="cc-header-count" id="cc-event-count"></span>' +
    '</div>';
  }

  /**
   * Render filter buttons
   */
  function renderFilters() {
    var html = ['<div class="cc-filters" role="group" aria-label="Event filters">'];

    var filterKeys = Object.keys(FILTER_DEFINITIONS);
    for (var i = 0; i < filterKeys.length; i++) {
      var key = filterKeys[i];
      var def = FILTER_DEFINITIONS[key];
      var isActive = state.activeFilters[key] ? 'true' : 'false';

      html.push(
        '<button type="button" class="cc-filter-btn" ' +
        'data-filter="' + key + '" ' +
        'aria-pressed="' + isActive + '">' +
        escapeHtml(def.label) +
        '</button>'
      );
    }

    html.push('</div>');
    return html.join('');
  }

  /**
   * Render a single event card
   */
  function renderEventCard(event) {
    var date = formatDate(parseDate(event.startDate));
    var hasUrl = event.url && event.url.length > 0;

    var html = [
      '<div class="cc-event-card" ',
      'data-event-id="' + escapeHtml(String(event.id)) + '" ',
      'data-clickable="' + hasUrl + '" ',
      hasUrl ? 'data-url="' + escapeHtml(event.url) + '" ' : '',
      'tabindex="0" role="article">',

      // Date column
      '<div class="cc-date-col">',
        '<div class="cc-date-month">' + escapeHtml(date.month) + '</div>',
        '<div class="cc-date-day">' + escapeHtml(String(date.day)) + '</div>',
        '<div class="cc-date-weekday">' + escapeHtml(date.weekday) + '</div>',
      '</div>',

      // Event info
      '<div class="cc-event-info">',
        '<h3 class="cc-event-name">' + escapeHtml(event.name) + '</h3>',
        '<div class="cc-event-meta">'
    ];

    // Time
    html.push(
      '<span class="cc-event-meta-item">' +
        '<svg class="cc-event-meta-icon" viewBox="0 0 24 24" fill="currentColor">' +
          '<path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z"/>' +
        '</svg>' +
        escapeHtml(date.time) +
      '</span>'
    );

    // Location
    if (event.location) {
      html.push(
        '<span class="cc-event-meta-item">' +
          '<svg class="cc-event-meta-icon" viewBox="0 0 24 24" fill="currentColor">' +
            '<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>' +
          '</svg>' +
          escapeHtml(event.location) +
        '</span>'
      );
    }

    html.push('</div>'); // end meta

    // Tags
    html.push('<div class="cc-event-tags">');
    if (event.isFree) {
      html.push('<span class="cc-tag cc-tag--free">Free</span>');
    }
    if (event.accessLevel === 'Public') {
      html.push('<span class="cc-tag cc-tag--public">Public</span>');
    }
    html.push('</div>');

    html.push('</div>'); // end event-info

    // Status column
    html.push('<div class="cc-status-col">');
    if (event.spotsAvailable !== null && event.spotsAvailable !== undefined) {
      if (event.spotsAvailable <= 0) {
        html.push('<span class="cc-status-badge cc-status-badge--full">Full</span>');
      } else if (event.spotsAvailable <= 5) {
        html.push('<span class="cc-status-badge cc-status-badge--limited">' +
          escapeHtml(String(event.spotsAvailable)) + ' left</span>');
      }
    }
    html.push('</div>');

    html.push('</div>'); // end card

    return html.join('');
  }

  /**
   * Render empty state
   */
  function renderEmpty() {
    return '<div class="cc-empty">' +
      '<div class="cc-empty-icon">ğŸ“…</div>' +
      '<p class="cc-empty-message">' + escapeHtml(config.emptyMessage) + '</p>' +
    '</div>';
  }

  /**
   * Update the event list display
   */
  function updateDisplay() {
    var listContainer = document.getElementById('cc-event-list');
    var countContainer = document.getElementById('cc-event-count');
    if (!listContainer) return;

    // Filter events
    var events = state.events.slice();

    // Apply public mode filter (security)
    events = filterForPublicMode(events);

    // Remove past events
    events = events.filter(function(e) { return !e.isPast; });

    // Apply user filters
    events = applyFilters(events);

    // Sort by date
    events.sort(function(a, b) {
      var dateA = parseDate(a.startDate);
      var dateB = parseDate(b.startDate);
      if (!dateA) return 1;
      if (!dateB) return -1;
      return dateA.getTime() - dateB.getTime();
    });

    // Limit
    if (config.maxEvents > 0 && events.length > config.maxEvents) {
      events = events.slice(0, config.maxEvents);
    }

    state.filteredEvents = events;

    // Update count
    if (countContainer) {
      countContainer.textContent = events.length + ' event' + (events.length !== 1 ? 's' : '');
    }

    // Render events
    if (events.length === 0) {
      listContainer.innerHTML = renderEmpty();
    } else {
      var html = [];
      for (var i = 0; i < events.length; i++) {
        html.push(renderEventCard(events[i]));
      }
      listContainer.innerHTML = html.join('');
    }

    // Update filter button states
    updateFilterButtonStates();
  }

  /**
   * Update filter button aria-pressed states
   */
  function updateFilterButtonStates() {
    var buttons = document.querySelectorAll('.cc-filter-btn[data-filter]');
    for (var i = 0; i < buttons.length; i++) {
      var btn = buttons[i];
      var filterKey = btn.getAttribute('data-filter');
      var isActive = state.activeFilters[filterKey] ? 'true' : 'false';
      btn.setAttribute('aria-pressed', isActive);
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EVENT HANDLING (Delegation - no inline handlers)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Setup event delegation for all interactions
   */
  function setupEventListeners(container) {
    // Click delegation
    container.addEventListener('click', function(e) {
      var target = e.target;

      // Filter button click
      var filterBtn = target.closest('.cc-filter-btn[data-filter]');
      if (filterBtn) {
        var filterKey = filterBtn.getAttribute('data-filter');
        toggleFilter(filterKey);
        return;
      }

      // Event card click
      var eventCard = target.closest('.cc-event-card[data-url]');
      if (eventCard) {
        var url = eventCard.getAttribute('data-url');
        if (url) {
          window.open(url, '_blank', 'noopener,noreferrer');
        }
        return;
      }
    });

    // Keyboard navigation
    container.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        var target = e.target;

        // Filter button
        if (target.classList.contains('cc-filter-btn')) {
          e.preventDefault();
          target.click();
          return;
        }

        // Event card
        if (target.classList.contains('cc-event-card')) {
          e.preventDefault();
          target.click();
          return;
        }
      }
    });
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // INITIALIZATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * Initialize the widget
   */
  function init() {
    // Merge config
    var userConfig = window.CLUBCALENDAR_CONFIG || {};
    config = {};
    for (var key in DEFAULT_CONFIG) {
      config[key] = DEFAULT_CONFIG.hasOwnProperty(key) ? DEFAULT_CONFIG[key] : undefined;
    }
    for (var key in userConfig) {
      config[key] = userConfig[key];
    }

    // Transform events
    var rawEvents = config.events || [];
    state.events = [];
    for (var i = 0; i < rawEvents.length; i++) {
      state.events.push(transformEvent(rawEvents[i]));
    }

    // Initialize filters
    state.activeFilters = {};

    // Render
    render();

    console.log('[ClubCalendar] Initialized with ' + state.events.length + ' events');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EXPOSE PUBLIC API
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  window.ClubCalendar = {
    init: init,
    refresh: function(newEvents) {
      config.events = newEvents || [];
      state.events = [];
      for (var i = 0; i < config.events.length; i++) {
        state.events.push(transformEvent(config.events[i]));
      }
      updateDisplay();
    },
    getState: function() {
      return {
        totalEvents: state.events.length,
        filteredEvents: state.filteredEvents.length,
        activeFilters: Object.keys(state.activeFilters).filter(function(k) {
          return state.activeFilters[k];
        })
      };
    }
  };

  // Auto-initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }

})();
</script>

<!--
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DEMO: Mock Data for Testing
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Uncomment the script below to test with mock data.
  In production, replace with your actual events array.
-->

<!--
<script>
window.CLUBCALENDAR_CONFIG = {
  headerTitle: 'Club Events',
  showFilters: true,
  isPublicMode: false,
  primaryColor: '#2c5aa0',
  accentColor: '#d4a800',

  autoTagRules: [
    { type: 'name-prefix', pattern: 'Happy Hikers:', tag: 'committee:hiking' },
    { type: 'name-prefix', pattern: 'Wine:', tag: 'committee:wine' }
  ],

  events: [
    {
      id: 1,
      name: 'Happy Hikers: Morning Trail Walk',
      startDate: '2025-01-15T09:00:00',
      endDate: '2025-01-15T12:00:00',
      location: 'Elings Park',
      description: 'Join us for a scenic morning hike.',
      url: 'https://example.com/event/1',
      tags: [],
      accessLevel: 'Members Only',
      isFree: true,
      spotsAvailable: 15
    },
    {
      id: 2,
      name: 'Wine: Tasting at Foxen',
      startDate: '2025-01-18T14:00:00',
      location: 'Foxen Winery',
      url: 'https://example.com/event/2',
      tags: [],
      accessLevel: 'Public',
      isFree: false,
      spotsAvailable: 3
    },
    {
      id: 3,
      name: 'New Member Orientation',
      startDate: '2025-01-20T10:00:00',
      location: 'Community Center',
      url: 'https://example.com/event/3',
      accessLevel: 'Public',
      isFree: true,
      spotsAvailable: null
    },
    {
      id: 4,
      name: 'Book Club: January Meeting',
      startDate: '2025-01-22T19:00:00',
      location: 'Online via Zoom',
      url: 'https://example.com/event/4',
      accessLevel: 'Members Only',
      isFree: true,
      spotsAvailable: 0
    }
  ]
};
</script>
-->
