<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ClubCalendar Inline Engine - Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .demo-container {
      max-width: 960px;
      margin: 0 auto;
      background: white;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .demo-header {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid #eee;
    }
    .demo-header h1 {
      margin: 0 0 8px 0;
      color: #2c5aa0;
    }
    .demo-header p {
      margin: 0;
      color: #666;
    }
    .demo-controls {
      background: #f9f9f9;
      padding: 16px;
      border-radius: 6px;
      margin-bottom: 24px;
    }
    .demo-controls h3 {
      margin: 0 0 12px 0;
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .demo-btn {
      display: inline-block;
      padding: 8px 16px;
      margin-right: 8px;
      margin-bottom: 8px;
      background: #2c5aa0;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .demo-btn:hover {
      background: #1e4080;
    }
    .demo-btn--secondary {
      background: #666;
    }
    .demo-btn--secondary:hover {
      background: #444;
    }
    .demo-state {
      margin-top: 24px;
      padding: 16px;
      background: #f0f4f8;
      border-radius: 6px;
      font-family: monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>

<div class="demo-container">
  <div class="demo-header">
    <h1>ClubCalendar Inline Engine</h1>
    <p>Self-contained render engine demo with mock data</p>
  </div>

  <div class="demo-controls">
    <h3>Demo Controls</h3>
    <button class="demo-btn" id="btn-refresh">Refresh Events</button>
    <button class="demo-btn" id="btn-add">Add Random Event</button>
    <button class="demo-btn demo-btn--secondary" id="btn-public">Toggle Public Mode</button>
    <button class="demo-btn demo-btn--secondary" id="btn-state">Log State</button>
  </div>

  <!-- The widget mounts here -->
  <div id="clubcalendar-root"></div>

  <div class="demo-state" id="demo-state">
    State will appear here after clicking "Log State"
  </div>
</div>

<!-- Configuration MUST come before the engine script -->
<script>
// Generate dates relative to today for realistic demo
function futureDate(daysFromNow, hour, minute) {
  var d = new Date();
  d.setDate(d.getDate() + daysFromNow);
  d.setHours(hour, minute || 0, 0, 0);
  return d.toISOString();
}

window.CLUBCALENDAR_CONFIG = {
  headerTitle: 'SBNC Events',
  showFilters: true,
  showHeader: true,
  isPublicMode: false,
  primaryColor: '#2c5aa0',
  accentColor: '#d4a800',
  maxEvents: 20,

  autoTagRules: [
    { type: 'name-prefix', pattern: 'Happy Hikers:', tag: 'committee:hiking' },
    { type: 'name-prefix', pattern: 'Wine:', tag: 'committee:wine' },
    { type: 'name-prefix', pattern: 'Games!:', tag: 'committee:games' },
    { type: 'name-prefix', pattern: 'Epicurious:', tag: 'committee:epicurious' },
    { type: 'name-prefix', pattern: 'TGIF:', tag: 'committee:tgif' }
  ],

  events: [
    {
      id: 1,
      name: 'Happy Hikers: Morning Trail Walk at Elings Park',
      startDate: futureDate(2, 9, 0),
      endDate: futureDate(2, 12, 0),
      location: 'Elings Park, Santa Barbara',
      description: 'Join us for a scenic morning hike with beautiful views.',
      url: 'https://example.com/event/1',
      tags: [],
      accessLevel: 'Members Only',
      isFree: true,
      spotsAvailable: 15
    },
    {
      id: 2,
      name: 'Wine: Tasting at Foxen Canyon',
      startDate: futureDate(5, 14, 0),
      location: 'Foxen Winery, Los Olivos',
      url: 'https://example.com/event/2',
      tags: [],
      accessLevel: 'Public',
      isFree: false,
      spotsAvailable: 3
    },
    {
      id: 3,
      name: 'New Member Orientation',
      startDate: futureDate(7, 10, 0),
      location: 'Faulkner Gallery, Santa Barbara Library',
      url: 'https://example.com/event/3',
      accessLevel: 'Public',
      isFree: true,
      spotsAvailable: null
    },
    {
      id: 4,
      name: 'Games!: Board Game Night',
      startDate: futureDate(8, 18, 30),
      location: 'Community Center Room A',
      url: 'https://example.com/event/4',
      accessLevel: 'Members Only',
      isFree: true,
      spotsAvailable: 0
    },
    {
      id: 5,
      name: 'Epicurious: French Bistro Dinner',
      startDate: futureDate(10, 18, 0),
      location: 'Petit Valentien',
      url: 'https://example.com/event/5',
      accessLevel: 'Members Only',
      isFree: false,
      spotsAvailable: 8
    },
    {
      id: 6,
      name: 'TGIF: Friday Social Hour',
      startDate: futureDate(3, 17, 0),
      location: 'The Brewhouse',
      url: 'https://example.com/event/6',
      accessLevel: 'Public',
      isFree: true,
      spotsAvailable: null
    },
    {
      id: 7,
      name: 'Happy Hikers: Sunset Beach Walk',
      startDate: futureDate(9, 16, 30),
      location: 'Leadbetter Beach',
      url: 'https://example.com/event/7',
      accessLevel: 'Members Only',
      isFree: true,
      spotsAvailable: 20
    },
    {
      id: 8,
      name: 'Wine: Champagne & Sparkling Workshop',
      startDate: futureDate(14, 15, 0),
      location: 'Santa Barbara Wine Collective',
      url: 'https://example.com/event/8',
      accessLevel: 'Public',
      isFree: false,
      spotsAvailable: 2
    }
  ]
};
</script>

<!-- Inline Engine (paste from clubcalendar-inline-engine.html) -->
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ClubCalendar Inline Engine - Scoped Styles
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

#clubcalendar-root {
  --cc-primary: var(--cc-primary-override, #2c5aa0);
  --cc-accent: var(--cc-accent-override, #d4a800);
  --cc-bg: #ffffff;
  --cc-text: #333333;
  --cc-text-muted: #666666;
  --cc-border: #e0e0e0;
  --cc-hover-bg: #f5f5f5;
  --cc-shadow: 0 2px 4px rgba(0,0,0,0.1);
  --cc-radius: 6px;

  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 14px;
  line-height: 1.5;
  color: var(--cc-text);
  background: var(--cc-bg);
  max-width: 900px;
  margin: 0 auto;
}

.cc-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0;
  border-bottom: 2px solid var(--cc-primary);
  margin-bottom: 16px;
}

.cc-header-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--cc-primary);
  margin: 0;
}

.cc-header-count {
  font-size: 0.875rem;
  color: var(--cc-text-muted);
  background: var(--cc-hover-bg);
  padding: 4px 12px;
  border-radius: 12px;
}

.cc-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 12px 0;
  border-bottom: 1px solid var(--cc-border);
  margin-bottom: 16px;
}

.cc-filter-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid var(--cc-border);
  border-radius: 16px;
  background: var(--cc-bg);
  color: var(--cc-text);
  font-size: 0.8125rem;
  cursor: pointer;
  transition: all 0.15s ease;
}

.cc-filter-btn:hover {
  background: var(--cc-hover-bg);
  border-color: var(--cc-primary);
}

.cc-filter-btn[aria-pressed="true"] {
  background: var(--cc-primary);
  border-color: var(--cc-primary);
  color: #ffffff;
}

.cc-event-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.cc-event-card {
  display: flex;
  gap: 16px;
  padding: 16px;
  border: 1px solid var(--cc-border);
  border-radius: var(--cc-radius);
  background: var(--cc-bg);
  transition: box-shadow 0.15s ease, border-color 0.15s ease;
}

.cc-event-card:hover {
  border-color: var(--cc-primary);
  box-shadow: var(--cc-shadow);
}

.cc-event-card[data-clickable="true"] {
  cursor: pointer;
}

.cc-date-col {
  flex-shrink: 0;
  width: 54px;
  text-align: center;
  padding: 8px;
  background: var(--cc-hover-bg);
  border-radius: var(--cc-radius);
}

.cc-date-month {
  font-size: 0.6875rem;
  font-weight: 600;
  text-transform: uppercase;
  color: var(--cc-primary);
  letter-spacing: 0.05em;
}

.cc-date-day {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--cc-text);
  line-height: 1.2;
}

.cc-date-weekday {
  font-size: 0.6875rem;
  color: var(--cc-text-muted);
  text-transform: uppercase;
}

.cc-event-info {
  flex: 1;
  min-width: 0;
}

.cc-event-name {
  font-size: 1rem;
  font-weight: 600;
  color: var(--cc-text);
  margin: 0 0 4px 0;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.cc-event-meta {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  font-size: 0.8125rem;
  color: var(--cc-text-muted);
  margin-bottom: 8px;
}

.cc-event-meta-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

.cc-event-meta-icon {
  width: 14px;
  height: 14px;
  opacity: 0.7;
}

.cc-event-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.cc-tag {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.6875rem;
  font-weight: 500;
  border-radius: 10px;
  background: var(--cc-hover-bg);
  color: var(--cc-text-muted);
}

.cc-tag--free {
  background: #e8f5e9;
  color: #2e7d32;
}

.cc-tag--public {
  background: #e3f2fd;
  color: #1565c0;
}

.cc-status-col {
  flex-shrink: 0;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

.cc-status-badge {
  padding: 4px 10px;
  font-size: 0.6875rem;
  font-weight: 600;
  border-radius: 12px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.cc-status-badge--open {
  background: #e8f5e9;
  color: #2e7d32;
}

.cc-status-badge--limited {
  background: #fff3e0;
  color: #e65100;
}

.cc-status-badge--full {
  background: #ffebee;
  color: #c62828;
}

.cc-empty {
  text-align: center;
  padding: 48px 24px;
  color: var(--cc-text-muted);
}

.cc-empty-icon {
  font-size: 3rem;
  margin-bottom: 16px;
  opacity: 0.5;
}

.cc-empty-message {
  font-size: 1rem;
  margin: 0;
}

@media (max-width: 600px) {
  .cc-event-card {
    flex-direction: column;
    gap: 12px;
  }
  .cc-date-col {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
  }
  .cc-status-col {
    flex-direction: row;
    justify-content: flex-start;
  }
}
</style>

<script>
(function() {
  'use strict';

  var DEFAULT_CONFIG = {
    events: [],
    headerTitle: 'Events',
    showHeader: true,
    showFilters: true,
    emptyMessage: 'No upcoming events found.',
    primaryColor: '#2c5aa0',
    accentColor: '#d4a800',
    maxEvents: 50,
    isPublicMode: false,
    autoTagRules: []
  };

  var config = {};
  var state = {
    events: [],
    filteredEvents: [],
    activeFilters: {}
  };

  function escapeHtml(str) {
    if (!str) return '';
    var div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  function parseDate(dateStr) {
    if (!dateStr) return null;
    try {
      var d = new Date(dateStr);
      return isNaN(d.getTime()) ? null : d;
    } catch (e) {
      return null;
    }
  }

  function formatDate(date) {
    if (!date) return { month: '', day: '', weekday: '', time: '' };
    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    var timeStr = hours + ':' + (minutes < 10 ? '0' : '') + minutes + ' ' + ampm;
    return { month: months[date.getMonth()], day: date.getDate(), weekday: days[date.getDay()], time: timeStr };
  }

  function isPastEvent(event) {
    var start = parseDate(event.startDate);
    return start ? start < new Date() : false;
  }

  function isWeekendEvent(event) {
    var start = parseDate(event.startDate);
    if (!start) return false;
    var day = start.getDay();
    return day === 0 || day === 6;
  }

  function applyAutoTags(event, rules) {
    var autoTags = [];
    var eventName = (event.name || '').toLowerCase();
    for (var i = 0; i < rules.length; i++) {
      var rule = rules[i];
      var pattern = (rule.pattern || '').toLowerCase();
      if (!pattern || !rule.tag) continue;
      var matched = false;
      if (rule.type === 'name-prefix') matched = eventName.indexOf(pattern) === 0;
      else if (rule.type === 'name-contains') matched = eventName.indexOf(pattern) !== -1;
      else if (rule.type === 'name-suffix') matched = eventName.indexOf(pattern) === eventName.length - pattern.length;
      if (matched) autoTags.push(rule.tag);
    }
    var start = parseDate(event.startDate);
    if (start) {
      var hour = start.getHours();
      if (hour < 12) autoTags.push('time:morning');
      else if (hour < 17) autoTags.push('time:afternoon');
      else autoTags.push('time:evening');
      if (isWeekendEvent(event)) autoTags.push('day:weekend');
    }
    if (event.spotsAvailable !== null && event.spotsAvailable !== undefined) {
      if (event.spotsAvailable <= 0) autoTags.push('availability:full');
      else if (event.spotsAvailable <= 5) autoTags.push('availability:limited');
      else autoTags.push('availability:open');
    }
    if (event.isFree) autoTags.push('cost:free');
    if (event.accessLevel === 'Public') autoTags.push('access:public');
    return autoTags;
  }

  function transformEvent(rawEvent) {
    var manualTags = Array.isArray(rawEvent.tags) ? rawEvent.tags.slice() : [];
    var autoTags = applyAutoTags(rawEvent, config.autoTagRules);
    var allTags = manualTags.concat(autoTags);
    var uniqueTags = [];
    var seen = {};
    for (var i = 0; i < allTags.length; i++) {
      if (!seen[allTags[i]]) { seen[allTags[i]] = true; uniqueTags.push(allTags[i]); }
    }
    return {
      id: rawEvent.id, name: rawEvent.name || 'Untitled Event', startDate: rawEvent.startDate,
      endDate: rawEvent.endDate, location: rawEvent.location || '', description: rawEvent.description || '',
      url: rawEvent.url || '', tags: uniqueTags, accessLevel: rawEvent.accessLevel || 'Public',
      isFree: Boolean(rawEvent.isFree), spotsAvailable: rawEvent.spotsAvailable, isPast: isPastEvent(rawEvent)
    };
  }

  function filterForPublicMode(events) {
    if (!config.isPublicMode) return events;
    return events.filter(function(event) { return event.accessLevel === 'Public'; });
  }

  var FILTER_DEFINITIONS = {
    weekend: { label: 'Weekend', test: function(event) { return isWeekendEvent(event); } },
    free: { label: 'Free', test: function(event) { return event.isFree; } },
    openings: { label: 'Has Openings', test: function(event) { return event.spotsAvailable === null || event.spotsAvailable > 0; } },
    public: { label: 'Public', test: function(event) { return event.accessLevel === 'Public'; } }
  };

  function applyFilters(events) {
    var activeKeys = Object.keys(state.activeFilters).filter(function(key) { return state.activeFilters[key]; });
    if (activeKeys.length === 0) return events;
    return events.filter(function(event) {
      for (var i = 0; i < activeKeys.length; i++) {
        var filterDef = FILTER_DEFINITIONS[activeKeys[i]];
        if (filterDef && !filterDef.test(event)) return false;
      }
      return true;
    });
  }

  function toggleFilter(filterKey) {
    state.activeFilters[filterKey] = !state.activeFilters[filterKey];
    updateDisplay();
  }

  function render() {
    var container = document.getElementById('clubcalendar-root');
    if (!container) { console.error('[ClubCalendar] Container not found'); return; }
    container.style.setProperty('--cc-primary-override', config.primaryColor);
    container.style.setProperty('--cc-accent-override', config.accentColor);
    var html = [];
    if (config.showHeader) {
      html.push('<div class="cc-header"><h2 class="cc-header-title">' + escapeHtml(config.headerTitle) + '</h2><span class="cc-header-count" id="cc-event-count"></span></div>');
    }
    if (config.showFilters) {
      html.push('<div class="cc-filters" role="group" aria-label="Event filters">');
      var filterKeys = Object.keys(FILTER_DEFINITIONS);
      for (var i = 0; i < filterKeys.length; i++) {
        var key = filterKeys[i], def = FILTER_DEFINITIONS[key];
        var isActive = state.activeFilters[key] ? 'true' : 'false';
        html.push('<button type="button" class="cc-filter-btn" data-filter="' + key + '" aria-pressed="' + isActive + '">' + escapeHtml(def.label) + '</button>');
      }
      html.push('</div>');
    }
    html.push('<div class="cc-event-list" id="cc-event-list"></div>');
    container.innerHTML = html.join('');
    updateDisplay();
    setupEventListeners(container);
  }

  function renderEventCard(event) {
    var date = formatDate(parseDate(event.startDate));
    var hasUrl = event.url && event.url.length > 0;
    var html = ['<div class="cc-event-card" data-event-id="' + escapeHtml(String(event.id)) + '" data-clickable="' + hasUrl + '" ' + (hasUrl ? 'data-url="' + escapeHtml(event.url) + '"' : '') + ' tabindex="0" role="article">'];
    html.push('<div class="cc-date-col"><div class="cc-date-month">' + escapeHtml(date.month) + '</div><div class="cc-date-day">' + escapeHtml(String(date.day)) + '</div><div class="cc-date-weekday">' + escapeHtml(date.weekday) + '</div></div>');
    html.push('<div class="cc-event-info"><h3 class="cc-event-name">' + escapeHtml(event.name) + '</h3><div class="cc-event-meta">');
    html.push('<span class="cc-event-meta-item"><svg class="cc-event-meta-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z"/></svg>' + escapeHtml(date.time) + '</span>');
    if (event.location) html.push('<span class="cc-event-meta-item"><svg class="cc-event-meta-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>' + escapeHtml(event.location) + '</span>');
    html.push('</div><div class="cc-event-tags">');
    if (event.isFree) html.push('<span class="cc-tag cc-tag--free">Free</span>');
    if (event.accessLevel === 'Public') html.push('<span class="cc-tag cc-tag--public">Public</span>');
    html.push('</div></div><div class="cc-status-col">');
    if (event.spotsAvailable !== null && event.spotsAvailable !== undefined) {
      if (event.spotsAvailable <= 0) html.push('<span class="cc-status-badge cc-status-badge--full">Full</span>');
      else if (event.spotsAvailable <= 5) html.push('<span class="cc-status-badge cc-status-badge--limited">' + escapeHtml(String(event.spotsAvailable)) + ' left</span>');
    }
    html.push('</div></div>');
    return html.join('');
  }

  function renderEmpty() {
    return '<div class="cc-empty"><div class="cc-empty-icon">ğŸ“…</div><p class="cc-empty-message">' + escapeHtml(config.emptyMessage) + '</p></div>';
  }

  function updateDisplay() {
    var listContainer = document.getElementById('cc-event-list');
    var countContainer = document.getElementById('cc-event-count');
    if (!listContainer) return;
    var events = filterForPublicMode(state.events.slice());
    events = events.filter(function(e) { return !e.isPast; });
    events = applyFilters(events);
    events.sort(function(a, b) {
      var dateA = parseDate(a.startDate), dateB = parseDate(b.startDate);
      if (!dateA) return 1; if (!dateB) return -1;
      return dateA.getTime() - dateB.getTime();
    });
    if (config.maxEvents > 0 && events.length > config.maxEvents) events = events.slice(0, config.maxEvents);
    state.filteredEvents = events;
    if (countContainer) countContainer.textContent = events.length + ' event' + (events.length !== 1 ? 's' : '');
    if (events.length === 0) listContainer.innerHTML = renderEmpty();
    else {
      var html = [];
      for (var i = 0; i < events.length; i++) html.push(renderEventCard(events[i]));
      listContainer.innerHTML = html.join('');
    }
    var buttons = document.querySelectorAll('.cc-filter-btn[data-filter]');
    for (var i = 0; i < buttons.length; i++) {
      var btn = buttons[i], filterKey = btn.getAttribute('data-filter');
      btn.setAttribute('aria-pressed', state.activeFilters[filterKey] ? 'true' : 'false');
    }
  }

  function setupEventListeners(container) {
    container.addEventListener('click', function(e) {
      var filterBtn = e.target.closest('.cc-filter-btn[data-filter]');
      if (filterBtn) { toggleFilter(filterBtn.getAttribute('data-filter')); return; }
      var eventCard = e.target.closest('.cc-event-card[data-url]');
      if (eventCard) { var url = eventCard.getAttribute('data-url'); if (url) window.open(url, '_blank', 'noopener,noreferrer'); }
    });
    container.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        if (e.target.classList.contains('cc-filter-btn') || e.target.classList.contains('cc-event-card')) {
          e.preventDefault(); e.target.click();
        }
      }
    });
  }

  function init() {
    var userConfig = window.CLUBCALENDAR_CONFIG || {};
    config = {};
    for (var key in DEFAULT_CONFIG) config[key] = DEFAULT_CONFIG[key];
    for (var key in userConfig) config[key] = userConfig[key];
    var rawEvents = config.events || [];
    state.events = [];
    for (var i = 0; i < rawEvents.length; i++) state.events.push(transformEvent(rawEvents[i]));
    state.activeFilters = {};
    render();
    console.log('[ClubCalendar] Initialized with ' + state.events.length + ' events');
  }

  window.ClubCalendar = {
    init: init,
    refresh: function(newEvents) {
      config.events = newEvents || [];
      state.events = [];
      for (var i = 0; i < config.events.length; i++) state.events.push(transformEvent(config.events[i]));
      updateDisplay();
    },
    getState: function() {
      return { totalEvents: state.events.length, filteredEvents: state.filteredEvents.length, activeFilters: Object.keys(state.activeFilters).filter(function(k) { return state.activeFilters[k]; }), isPublicMode: config.isPublicMode };
    },
    setPublicMode: function(isPublic) { config.isPublicMode = isPublic; updateDisplay(); }
  };

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else init();
})();
</script>

<!-- Demo Controls Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  var stateEl = document.getElementById('demo-state');

  document.getElementById('btn-state').addEventListener('click', function() {
    var state = window.ClubCalendar.getState();
    stateEl.textContent = JSON.stringify(state, null, 2);
  });

  document.getElementById('btn-refresh').addEventListener('click', function() {
    window.ClubCalendar.refresh(window.CLUBCALENDAR_CONFIG.events);
    stateEl.textContent = 'Events refreshed.';
  });

  document.getElementById('btn-add').addEventListener('click', function() {
    var events = window.CLUBCALENDAR_CONFIG.events;
    var newId = events.length + 100;
    var futureDate = new Date();
    futureDate.setDate(futureDate.getDate() + Math.floor(Math.random() * 20) + 1);
    futureDate.setHours(Math.floor(Math.random() * 12) + 8, 0, 0, 0);

    var names = ['Happy Hikers: Coastal Trail', 'Wine: Red Wine Tasting', 'Games!: Trivia Night', 'Epicurious: Italian Dinner', 'TGIF: Sunset Social'];
    var locations = ['Elings Park', 'Local Winery', 'Community Center', 'Italian Restaurant', 'Beach Pavilion'];

    events.push({
      id: newId,
      name: names[Math.floor(Math.random() * names.length)],
      startDate: futureDate.toISOString(),
      location: locations[Math.floor(Math.random() * locations.length)],
      url: 'https://example.com/event/' + newId,
      accessLevel: Math.random() > 0.3 ? 'Members Only' : 'Public',
      isFree: Math.random() > 0.5,
      spotsAvailable: Math.random() > 0.3 ? Math.floor(Math.random() * 20) : null
    });

    window.ClubCalendar.refresh(events);
    stateEl.textContent = 'Added event ' + newId;
  });

  document.getElementById('btn-public').addEventListener('click', function() {
    var state = window.ClubCalendar.getState();
    window.ClubCalendar.setPublicMode(!state.isPublicMode);
    stateEl.textContent = 'Public mode: ' + (!state.isPublicMode);
  });
});
</script>

</body>
</html>
